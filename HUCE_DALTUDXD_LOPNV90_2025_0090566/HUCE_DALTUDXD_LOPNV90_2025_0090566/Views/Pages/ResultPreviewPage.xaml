<Page x:Class="HUCE_DALTUDXD_LOPNV90_2025_0090566.Views.Pages.ResultPreviewPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:HUCE_DALTUDXD_LOPNV90_2025_0090566.Views.Pages"
      mc:Ignorable="d" 
      Title="Kết quả sơ bộ"
      d:DesignHeight="700" d:DesignWidth="1280"
      Background="White">

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" BorderBrush="#DDDDDD" BorderThickness="0,0,0,2" Margin="0,0,0,15" Padding="0,0,0,10">
            <StackPanel>
                <TextBlock Text="BẢNG TỔNG HỢP KẾT QUẢ TÍNH TOÁN CỐT THÉP" 
                           FontSize="22" FontWeight="Bold" Foreground="#2C3E50" HorizontalAlignment="Left"/>
                <TextBlock Text="(Các cột không đạt hoặc mất ổn định sẽ được tô màu cảnh báo)" 
                           FontSize="14" FontStyle="Italic" Foreground="Gray" Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <DataGrid Grid.Row="1" ItemsSource="{Binding ResultsList}" 
          SelectedItem="{Binding SelectedResult}"
          AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True"
          BorderBrush="#95A5A6" BorderThickness="1"
          RowHeight="40" FontSize="13" 
          AlternatingRowBackground="#F4F6F6" GridLinesVisibility="All"
          HeadersVisibility="Column" HorizontalScrollBarVisibility="Auto"
          VerticalScrollBarVisibility="Auto">

            <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="FontWeight" Value="Bold"/>
                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    <Setter Property="Padding" Value="5,10,5,10"/>
                    <Setter Property="Background" Value="#ECF0F1"/>
                    <Setter Property="BorderBrush" Value="#BDC3C7"/>
                    <Setter Property="BorderThickness" Value="0,0,1,1"/>
                </Style>
            </DataGrid.ColumnHeaderStyle>

            <DataGrid.Resources>
                <Style TargetType="TextBlock" x:Key="CenterCell">
                    <Setter Property="HorizontalAlignment" Value="Center"/>
                    <Setter Property="VerticalAlignment" Value="Center"/>
                </Style>
            </DataGrid.Resources>

            <DataGrid.Columns>
                <DataGridTextColumn Header="Tên" Binding="{Binding ColumnName}" FontWeight="Bold" Width="50" ElementStyle="{StaticResource CenterCell}"/>
                <DataGridTextColumn Header="Tiết diện" Binding="{Binding B, StringFormat='{}{0}x'}" Width="60" ElementStyle="{StaticResource CenterCell}"/>
                <DataGridTextColumn Header="h (mm)" Binding="{Binding H}" Width="60" ElementStyle="{StaticResource CenterCell}"/>

                <DataGridTextColumn Header="N (kN)" Binding="{Binding N}" Width="70" FontWeight="SemiBold" ElementStyle="{StaticResource CenterCell}"/>
                <DataGridTextColumn Header="Mx (kNm)" Binding="{Binding Mx}" Width="70" ElementStyle="{StaticResource CenterCell}"/>

                <DataGridTextColumn Header="L0 (mm)" Binding="{Binding L0, StringFormat=N0}" Width="65" ElementStyle="{StaticResource CenterCell}"/>
                <DataGridTextColumn Header="λ" Binding="{Binding Lambda, StringFormat=N1}" Width="50" ElementStyle="{StaticResource CenterCell}"/>

                <DataGridTextColumn Header="η" Binding="{Binding Eta, StringFormat=N2}" Width="50" FontWeight="Bold" Foreground="#D35400">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="ToolTip" Value="Hệ số uốn dọc (phải >= 1)"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="e0 (mm)" Binding="{Binding E0, StringFormat=N0}" Width="60" ElementStyle="{StaticResource CenterCell}"/>

                <DataGridTextColumn Header="As(1 bên)" Binding="{Binding As_OneSide, StringFormat=N0}" 
                            Foreground="Gray" Width="70" ElementStyle="{StaticResource CenterCell}"/>

                <DataGridTextColumn Header="ΣAs.yc" Binding="{Binding As_Required, StringFormat=N0}" 
                            Foreground="Red" FontWeight="Bold" Width="80" ElementStyle="{StaticResource CenterCell}"/>

                <DataGridTextColumn Header="BỐ TRÍ THÉP (X+Y)" Binding="{Binding ResultString}" 
                            Foreground="#2980B9" FontWeight="ExtraBold" Width="160">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Left"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="Padding" Value="5,0,0,0"/>
                            <Setter Property="TextWrapping" Value="Wrap"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="As.chọn" Binding="{Binding As_Provided, StringFormat=N0}" Width="70" ElementStyle="{StaticResource CenterCell}"/>

                <DataGridTextColumn Header="μ (%)" Binding="{Binding Mu_Percentage, StringFormat=N2}" Width="60" ElementStyle="{StaticResource CenterCell}"/>

                <DataGridTextColumn Header="Cốt Đai" Binding="{Binding StirrupInfo}" Width="90" ElementStyle="{StaticResource CenterCell}"/>

                <DataGridTextColumn Header="Trạng thái" Binding="{Binding Status}" Width="100" FontWeight="Bold">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Status}" Value="Đạt">
                                    <Setter Property="Foreground" Value="Green"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="Không đạt">
                                    <Setter Property="Foreground" Value="Red"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="Mất ổn định">
                                    <Setter Property="Foreground" Value="#E67E22"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="Lỗi">
                                    <Setter Property="Foreground" Value="DarkRed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Ghi chú" Binding="{Binding Note}" Width="*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="TextWrapping" Value="Wrap"/>
                            <Setter Property="Padding" Value="5,0"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="FontSize" Value="12"/>
                            <Setter Property="Foreground" Value="Gray"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>

        <Border Grid.Row="2" Background="#FAFAFA" BorderBrush="#DDDDDD" BorderThickness="1" Padding="10" Margin="0,10,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                    <TextBlock Text="Hướng dẫn:" FontWeight="Bold" Foreground="#7F8C8D"/>
                    <TextBlock Text="- Kiểm tra hệ số η (phải >= 1). Nếu η quá lớn, cột có nguy cơ mất ổn định." Foreground="Gray"/>
                    <TextBlock Text="- Nếu hàm lượng μ > 4%, cân nhắc tăng tiết diện cột." Foreground="Gray"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="(Chọn 1 dòng để xem chi tiết)" VerticalAlignment="Center" 
                               Margin="0,0,10,0" FontStyle="Italic" Foreground="Gray"/>

                    <Button Content="XEM CHI TIẾT &amp; VẼ HÌNH >>" 
                            Click="BtnGoToDetail_Click"
                            Background="#8E44AD" Foreground="White"
                            Width="220" Height="40" FontSize="14" FontWeight="Bold"
                            Style="{StaticResource MainButtonStyle}">
                        <Button.Effect>
                            <DropShadowEffect Color="Gray" BlurRadius="5" ShadowDepth="2" Direction="270" Opacity="0.3"/>
                        </Button.Effect>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Page>
