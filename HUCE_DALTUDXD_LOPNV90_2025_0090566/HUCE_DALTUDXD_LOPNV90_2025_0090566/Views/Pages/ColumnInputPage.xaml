<Page x:Class="HUCE_DALTUDXD_LOPNV90_2025_0090566.Views.Pages.ColumnInputPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:HUCE_DALTUDXD_LOPNV90_2025_0090566.Views.Pages"
      mc:Ignorable="d" 
      Title="Nhập dữ liệu đầu vào"
      d:DesignHeight="700" d:DesignWidth="1200"
      Background="White">

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="380" MinWidth="300" MaxWidth="550"/>
            <ColumnDefinition Width="5"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="5" Background="#FAFAFA">
            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                <StackPanel>
                    <TextBlock Text="THÔNG TIN CỘT" FontSize="18" FontWeight="Bold" Foreground="#2C3E50" Margin="0,0,0,15"/>

                    <TextBlock Text="Tên cột / Số hiệu (VD: C1, C2...):" Style="{StaticResource LabelStyle}"/>
                    <TextBox Text="{Binding CurrentColumn.ColumnName, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" 
                             Style="{StaticResource InputTextBoxStyle}" FontWeight="Bold"/>

                    <GroupBox Header="I. Vật liệu &amp; Cấu tạo" Margin="0,0,0,10" Padding="5" BorderBrush="#AAAAAA">
                        <StackPanel>
                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition Width="80"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Cấp độ bền Bê tông:"/>
                                    <ComboBox ItemsSource="{Binding ConcreteGrades}" 
                                              SelectedItem="{Binding CurrentColumn.ConcreteGrade}"
                                              Height="30" Margin="0,0,5,0" VerticalContentAlignment="Center"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Rb (MPa):"/>
                                    <TextBox Text="{Binding CurrentColumn.Rb}" IsReadOnly="True" Background="#E8E8E8" Height="30" VerticalContentAlignment="Center" FontWeight="SemiBold"/>
                                </StackPanel>
                            </Grid>

                            <Grid Margin="0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition Width="80"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Mác thép chủ:"/>
                                    <ComboBox ItemsSource="{Binding SteelGrades}" 
                                              SelectedItem="{Binding CurrentColumn.SteelGrade}"
                                              Height="30" Margin="0,0,5,0" VerticalContentAlignment="Center"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Rs (MPa):"/>
                                    <TextBox Text="{Binding CurrentColumn.Rs}" IsReadOnly="True" Background="#E8E8E8" Height="30" VerticalContentAlignment="Center" FontWeight="SemiBold"/>
                                </StackPanel>
                            </Grid>

                            <TextBlock Text="Lớp bảo vệ cốt thép a (mm):" Margin="0,5,0,0"/>
                            <TextBox Text="{Binding CurrentColumn.ConcreteCover, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" 
                                     Style="{StaticResource InputTextBoxStyle}"/>
                        </StackPanel>
                    </GroupBox>

                    <GroupBox Header="II. Kích thước hình học" Margin="0,0,0,10" Padding="5" BorderBrush="#AAAAAA">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <StackPanel Margin="0,0,5,5">
                                <TextBlock Text="Rộng b (mm):"/>
                                <TextBox Text="{Binding CurrentColumn.B, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" 
                                         Style="{StaticResource InputTextBoxStyle}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="5,0,0,5">
                                <TextBlock Text="Cao h (mm):"/>
                                <TextBox Text="{Binding CurrentColumn.H, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" 
                                         Style="{StaticResource InputTextBoxStyle}"/>
                            </StackPanel>

                            <StackPanel Grid.Row="1" Grid.ColumnSpan="2">
                                <TextBlock Text="Chiều dài cột L (mm):"/>
                                <TextBox Text="{Binding CurrentColumn.L, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" 
                                         Style="{StaticResource InputTextBoxStyle}"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <GroupBox Header="III. Nội lực &amp; Điều kiện biên" Margin="0,0,0,15" Padding="5" BorderBrush="#AAAAAA">
                        <StackPanel>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Margin="0,0,5,0">
                                    <TextBlock Text="Lực dọc N (kN):"/>
                                    <TextBox Text="{Binding CurrentColumn.N, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource InputTextBoxStyle}"
                                             Foreground="{Binding CurrentColumn.N, Converter={StaticResource NumberToColorConverter}}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Margin="5,0,0,0">
                                    <TextBlock Text="Liên kết 2 đầu (ψ):"/>
                                    <ComboBox ItemsSource="{Binding PsiOptions}"
                                              SelectedValue="{Binding CurrentColumn.Psi}"
                                              DisplayMemberPath="Name"
                                              SelectedValuePath="Value"
                                              Height="30" Margin="0,0,0,15" VerticalContentAlignment="Center"/>
                                </StackPanel>
                            </Grid>

                            <Grid Margin="0,5,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Margin="0,0,5,0">
                                    <TextBlock Text="Mô men Mx (kNm):"/>
                                    <TextBox Text="{Binding CurrentColumn.Mx, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InputTextBoxStyle}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="5,0,0,0">
                                    <TextBlock Text="Mô men My (kNm):"/>
                                    <TextBox Text="{Binding CurrentColumn.My, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InputTextBoxStyle}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" Content="THÊM VÀO BẢNG" Command="{Binding AddColumnCommand}" 
                                Background="#27AE60" Style="{StaticResource MainButtonStyle}" 
                                Margin="0,0,10,0"/>
                        <Button Grid.Column="1" Content="LƯU CHỈNH SỬA" Command="{Binding UpdateColumnCommand}" 
                                Background="#F39C12" Style="{StaticResource MainButtonStyle}" 
                                Margin="10,0,0,0"/>
                    </Grid>

                    <Button Content="Xóa trắng Form (Tạo mới)" Command="{Binding ClearFormCommand}" Margin="0,15,0,0" Height="30" Background="Transparent" Foreground="#555555" BorderThickness="0">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <TextBlock Text="{TemplateBinding Content}" TextDecorations="Underline" Cursor="Hand" HorizontalAlignment="Center"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#E0E0E0" ShowsPreview="True"/>

        <Grid Grid.Column="2" Margin="10,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                <TextBlock Text="DANH SÁCH CỘT CẦN TÍNH TOÁN" FontSize="18" FontWeight="Bold" Foreground="#2C3E50" VerticalAlignment="Center"/>
                <TextBlock Text="(Tích chọn vào ô vuông để tính nhiều cột)" Margin="10,0,0,0" FontStyle="Italic" VerticalAlignment="Center" Foreground="Gray"/>
            </StackPanel>

            <DataGrid Grid.Row="1" 
                      ItemsSource="{Binding ColumnsList}" 
                      SelectedItem="{Binding SelectedColumnInGrid}"
                      AutoGenerateColumns="False" 
                      CanUserAddRows="False"
                      GridLinesVisibility="Horizontal"
                      BorderThickness="1" BorderBrush="#AAAAAA"
                      AlternatingRowBackground="#F9F9F9" 
                      RowHeight="35" FontSize="14" HeadersVisibility="Column">

                <DataGrid.Columns>
                    <DataGridCheckBoxColumn Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" Header="Chọn" Width="50">
                        <DataGridCheckBoxColumn.ElementStyle>
                            <Style TargetType="CheckBox">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridCheckBoxColumn.ElementStyle>
                    </DataGridCheckBoxColumn>

                    <DataGridTextColumn Header="Tên Cột" Binding="{Binding ColumnName}" Width="80" FontWeight="Bold"/>
                    <DataGridTextColumn Header="Tiết diện" Binding="{Binding B, StringFormat='{}{0}x'}"/>
                    <DataGridTextColumn Header="h (mm)" Binding="{Binding H, StringFormat='{}{0}'}" Width="60"/>
                    <DataGridTextColumn Header="Bê tông" Binding="{Binding ConcreteGrade}" Width="70"/>
                    <DataGridTextColumn Header="N (kN)" Binding="{Binding N}" Width="90" FontWeight="SemiBold"/>
                    <DataGridTextColumn Header="Mx (kNm)" Binding="{Binding Mx}" Width="80"/>
                    <DataGridTextColumn Header="My (kNm)" Binding="{Binding My}" Width="80"/>
                    <DataGridTextColumn Header="Hệ số ψ" Binding="{Binding Psi}" Width="60"/>
                </DataGrid.Columns>
            </DataGrid>

            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
                <Button Content="Xóa cột đã chọn" Command="{Binding DeleteColumnCommand}" 
                        Background="#C0392B" Width="150" Margin="0,0,15,0" Style="{StaticResource MainButtonStyle}"/>

                <Button Content="TÍNH TOÁN CÁC CỘT ĐÃ CHỌN" Command="{Binding CalculateCommand}" 
                        Background="#2980B9" Width="280" Height="50" FontSize="15" FontWeight="ExtraBold"
                        Style="{StaticResource MainButtonStyle}">
                    <Button.Effect>
                        <DropShadowEffect Color="Gray" BlurRadius="5" ShadowDepth="2" Direction="270" Opacity="0.5"/>
                    </Button.Effect>
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
