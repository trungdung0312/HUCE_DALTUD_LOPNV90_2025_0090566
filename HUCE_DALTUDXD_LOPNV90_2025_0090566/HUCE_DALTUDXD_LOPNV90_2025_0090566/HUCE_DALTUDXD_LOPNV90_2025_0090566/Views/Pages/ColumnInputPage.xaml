<Page x:Class="HUCE_DALTUDXD_LOPNV90_2025_0090566.Views.Pages.ColumnInputPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:HUCE_DALTUDXD_LOPNV90_2025_0090566.Views.Pages"
      mc:Ignorable="d" 
      Title="Nhập dữ liệu đầu vào"
      d:DesignHeight="720" d:DesignWidth="1060"
      Background="White">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="3" Background="#F8F9FA" Padding="10" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="270"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="340"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <GroupBox Grid.Column="0" Header="1. THÔNG TIN &amp; HÌNH HỌC" BorderBrush="#95A5A6" FontWeight="SemiBold">
                    <StackPanel Margin="5">
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Tên Cột:" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Text="{Binding CurrentColumn.ColumnName, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" 
                                     Style="{StaticResource InputTextBoxStyle}" FontWeight="Bold" HorizontalContentAlignment="Center"/>
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="15"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Tiết diện (mm):" VerticalAlignment="Center" FontSize="11"/>

                            <TextBox Grid.Column="1" Text="{Binding CurrentColumn.B, ValidatesOnDataErrors=True, UpdateSourceTrigger=LostFocus}" 
                                     Style="{StaticResource InputTextBoxStyle}" ToolTip="Chiều rộng b (mm)"/>

                            <TextBlock Grid.Column="2" Text="x" HorizontalAlignment="Center" VerticalAlignment="Center"/>

                            <TextBox Grid.Column="3" Text="{Binding CurrentColumn.H, ValidatesOnDataErrors=True, UpdateSourceTrigger=LostFocus}" 
                                     Style="{StaticResource InputTextBoxStyle}" ToolTip="Chiều cao h (mm)"/>
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Chiều dài L (mm):" VerticalAlignment="Center" FontSize="11"/>
                            <TextBox Grid.Column="1" Text="{Binding CurrentColumn.L, ValidatesOnDataErrors=True, UpdateSourceTrigger=LostFocus}" 
                                     Style="{StaticResource InputTextBoxStyle}" ToolTip="Chiều dài tính toán L0 (mm)"/>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Hệ số ψ:" VerticalAlignment="Center"/>
                            <ComboBox Grid.Column="1" ItemsSource="{Binding PsiOptions}"
                                      SelectedValue="{Binding CurrentColumn.Psi}"
                                      DisplayMemberPath="Name"
                                      SelectedValuePath="Value"
                                      Height="26" VerticalContentAlignment="Center"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>

                <GroupBox Grid.Column="2" Header="2. VẬT LIỆU &amp; CẤU TẠO" BorderBrush="#95A5A6" FontWeight="SemiBold">
                    <StackPanel Margin="5">
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="65"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="65"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Bê tông:" VerticalAlignment="Center"/>
                            <ComboBox Grid.Column="1" ItemsSource="{Binding ConcreteGrades}" 
                                      SelectedItem="{Binding CurrentColumn.ConcreteGrade}" Height="26"/>
                            <TextBox Grid.Column="3" Text="{Binding CurrentColumn.Rb}" IsReadOnly="True" Background="#EEE" Height="26" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" FontWeight="Bold" ToolTip="Cường độ Rb (MPa)"/>
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="65"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="65"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Thép Chủ:" VerticalAlignment="Center"/>
                            <ComboBox Grid.Column="1" ItemsSource="{Binding SteelGrades}" 
                                      SelectedItem="{Binding CurrentColumn.SteelGrade}" Height="26"/>
                            <TextBox Grid.Column="3" Text="{Binding CurrentColumn.Rs}" IsReadOnly="True" Background="#EEE" Height="26" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" FontWeight="Bold" ToolTip="Cường độ Rs (MPa)"/>
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="65"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="5"/>
                                <ColumnDefinition Width="50"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="65"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Cốt Đai:" VerticalAlignment="Center"/>
                            <ComboBox Grid.Column="1" ItemsSource="{Binding StirrupGrades}" 
                                      SelectedItem="{Binding CurrentColumn.StirrupGrade}" Height="26"/>
                            <ComboBox Grid.Column="3" ItemsSource="{Binding StirrupDiameters}"
                                      SelectedItem="{Binding CurrentColumn.StirrupDiameter}" Height="26" ToolTip="Đường kính đai"/>
                            <TextBox Grid.Column="5" Text="{Binding CurrentColumn.Rsw}" IsReadOnly="True" Background="#EEE" Height="26" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" FontWeight="Bold" ToolTip="Cường độ Rsw (MPa)"/>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="65"/>
                                <ColumnDefinition Width="60"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Lớp a (mm):" VerticalAlignment="Center" FontSize="11"/>
                            <TextBox Grid.Column="1" Text="{Binding CurrentColumn.ConcreteCover, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}" 
                                     Style="{StaticResource InputTextBoxStyle}" ToolTip="Lớp bảo vệ (mm)"/>

                            <CheckBox Grid.Column="3" IsChecked="{Binding CurrentColumn.IsVerticalPouring}" VerticalAlignment="Center">
                                <TextBlock Text="Đổ cao > 1.5m" FontStyle="Italic" Foreground="#C0392B" FontSize="11"/>
                            </CheckBox>
                        </Grid>
                    </StackPanel>
                </GroupBox>

                <GroupBox Grid.Column="4" Header="3. NỘI LỰC (TTGH 1)" BorderBrush="#2980B9" FontWeight="SemiBold">
                    <Grid Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="60"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="10"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="1" Text="TOÀN BỘ" HorizontalAlignment="Center" Foreground="#C0392B" FontSize="10" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBlock Grid.Row="0" Grid.Column="3" Text="DÀI HẠN" HorizontalAlignment="Center" Foreground="#2980B9" FontSize="10" FontWeight="Bold" Margin="0,0,0,5"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Lực N (kN):" VerticalAlignment="Center" FontSize="11"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding CurrentColumn.N, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}" 
                                 Style="{StaticResource InputTextBoxStyle}" Margin="0,0,0,8" FontWeight="Bold"/>
                        <TextBox Grid.Row="1" Grid.Column="3" Text="{Binding CurrentColumn.N_LongTerm, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}" 
                                 Style="{StaticResource InputTextBoxStyle}" Margin="0,0,0,8"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Mx (kNm):" VerticalAlignment="Center" FontSize="11"/>
                        <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding CurrentColumn.Mx, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}" 
                                 Style="{StaticResource InputTextBoxStyle}" Margin="0,0,0,8"/>
                        <TextBox Grid.Row="2" Grid.Column="3" Text="{Binding CurrentColumn.Mx_LongTerm, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}" 
                                 Style="{StaticResource InputTextBoxStyle}" Margin="0,0,0,8"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="My (kNm):" VerticalAlignment="Center" FontSize="11"/>
                        <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding CurrentColumn.My, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}" 
                                 Style="{StaticResource InputTextBoxStyle}"/>
                        <TextBox Grid.Row="3" Grid.Column="3" Text="{Binding CurrentColumn.My_LongTerm, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}" 
                                 Style="{StaticResource InputTextBoxStyle}"/>
                    </Grid>
                </GroupBox>
            </Grid>
        </Border>

        <DataGrid Grid.Row="1" 
                  ItemsSource="{Binding ColumnsList}" 
                  SelectedItem="{Binding SelectedColumnInGrid}"
                  AutoGenerateColumns="False" CanUserAddRows="False"
                  GridLinesVisibility="Horizontal" BorderThickness="1" BorderBrush="#AAAAAA"
                  AlternatingRowBackground="#F9F9F9" RowHeight="30" FontSize="13" HeadersVisibility="Column"
                  Margin="0,0,0,10">

            <DataGrid.Columns>
                <DataGridCheckBoxColumn Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" Header="Chọn" Width="40"/>
                <DataGridTextColumn Header="Tên Cột" Binding="{Binding ColumnName}" Width="70" FontWeight="Bold"/>
                <DataGridTextColumn Header="Tiết diện (mm)" Binding="{Binding B, StringFormat='{}{0}x'}"/>
                <DataGridTextColumn Header="h (mm)" Binding="{Binding H}" Width="60"/>
                <DataGridTextColumn Header="L (mm)" Binding="{Binding L}" Width="60"/>
                <DataGridTextColumn Header="Bê tông" Binding="{Binding ConcreteGrade}" Width="60"/>
                <DataGridTextColumn Header="Thép Chủ" Binding="{Binding SteelGrade}" Width="80"/>
                <DataGridTextColumn Header="Thép Đai" Binding="{Binding StirrupGrade}" Width="70"/>
                <DataGridTextColumn Header="Φ Đai" Binding="{Binding StirrupDiameter}" Width="50"/>
                <DataGridTextColumn Header="N (kN)" Binding="{Binding N}" Width="70" FontWeight="SemiBold"/>

                <DataGridTextColumn Header="Mx (kNm)" Binding="{Binding Mx}" Width="70"/>
                <DataGridTextColumn Header="My (kNm)" Binding="{Binding My}" Width="70"/>

                <DataGridTextColumn Header="N.dh (kN)" Binding="{Binding N_LongTerm}" Width="70" Foreground="#2980B9"/>
                <DataGridTextColumn Header="Mx.dh (kNm)" Binding="{Binding Mx_LongTerm}" Width="80" Foreground="#2980B9"/>
                <DataGridTextColumn Header="My.dh (kNm)" Binding="{Binding My_LongTerm}" Width="80" Foreground="#2980B9"/>

                <DataGridCheckBoxColumn Header=">1.5m" Binding="{Binding IsVerticalPouring}" Width="50"/>
            </DataGrid.Columns>
        </DataGrid>

        <Border Grid.Row="2" Background="#EEEEEE" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="3" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="Thao tác Form:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,10,0" Foreground="Gray"/>
                    <Button Content="TẠO MỚI (Reset)" Command="{Binding ClearFormCommand}" Width="110" Height="35" Margin="0,0,5,0" Background="White" BorderBrush="Gray" BorderThickness="1"/>
                    <Button Content="THÊM VÀO BẢNG" Command="{Binding AddColumnCommand}" Width="130" Height="35" Margin="0,0,5,0" Background="#27AE60" Foreground="White" FontWeight="Bold" Style="{StaticResource MainButtonStyle}"/>
                    <Button Content="LƯU SỬA ĐỔI" Command="{Binding UpdateColumnCommand}" Width="110" Height="35" Background="#F39C12" Foreground="White" FontWeight="Bold" Style="{StaticResource MainButtonStyle}"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="Xóa dòng chọn" Command="{Binding DeleteColumnCommand}" Width="110" Height="35" Margin="0,0,20,0" Background="#E74C3C" Foreground="White" FontWeight="Bold" Style="{StaticResource MainButtonStyle}"/>
                    <Button Content="TÍNH TOÁN NGAY >" Command="{Binding CalculateCommand}" Width="200" Height="45" FontSize="15" FontWeight="ExtraBold" Background="#2980B9" Foreground="White" Style="{StaticResource MainButtonStyle}">
                        <Button.Effect>
                            <DropShadowEffect Color="Gray" BlurRadius="5" ShadowDepth="2" Direction="270" Opacity="0.3"/>
                        </Button.Effect>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Page>
